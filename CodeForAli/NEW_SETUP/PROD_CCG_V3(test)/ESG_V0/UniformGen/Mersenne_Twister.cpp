#include "Mersenne_Twister.h"

// Generation of uniform pseudorandom numbers using Mersenne Twister Algorithm

// 0x means that the following number will be written in base 16 (0xffffffff = 2^32-1)
// & represents the binary and
// | represents the binary or
// ^ represents the binary exclusive or
// a<<b means that the bits of a are translated to the left b times (the bits at the beginning disappear)
// a>>b means that the bits of a are translated to the right b times (the bits at the end disappear)

// Initialisiation of an array of size 624 filled with 32-bits integers
//void sgenrand(unsigned long seed){
//	mt[0]=seed & 0xffffffff; // for >32 bit machines
//	for (mti=1;mti<N;mti++) mt[mti]=(69069*mt[mti-1]) & 0xffffffff;
//}

MT::MT():UniformGen(N){
	SeedSize=N;
	//Seed=new unsigned long [SeedSize];
	Initialisation_seed0();
	//mti=N+1;

}
MT::MT(unsigned long * seed,int size,int m):UniformGen(seed,size,m){}

void MT::Initialisation_seed0(){
		long mt_init[N] = {	22695478	,	2156045615	,	2867233980	,	71484141	,	2911408402	,	2613937339	,	1153135800	,	420428313	,	1503962414	,	4187371143	,	590113780	,	3101602181	,	234047114	,	1499440787	,	3359393392	,	89175345	,	2502193446	,	3898671327	,	3619627052	,	1641484573	,	3924779266	,	2060562795	,	471225640	,	3064058185	,	4193161758	,	3950339127	,	4130111844	,	1741373877	,	968605818	,	1298662723	,	3568402656	,	1287908961	,	3326863382	,	3693723791	,	2392223644	,	872325965	,	260785394	,	3588948507	,	3167332760	,	3202116729	,	1211716366	,	2887284199	,	1865599700	,	2715325925	,	386190954	,	908527603	,	3639521104	,	2499062673	,	1156035334	,	3533694015	,	3486216972	,	2154068349	,	1690516706	,	2725017291	,	990147080	,	2977565609	,	2956716030	,	1247964055	,	3443411012	,	600944149	,	2513793114	,	3876564643	,	2781008320	,	717089985	,	3025064438	,	516320239	,	3036490364	,	116626349	,	1061046482	,	2112425851	,		3518072	,	880127705	,	149770478	,	2306229575	,	546175412	,	2093058629	,	2910103114	,	869595475	,	2570905648	,	423277041	,	2602058982	,	2682279839	,	3775567340	,	1909912029	,	4091766978	,	1580452907	,	990666472	,	1141528073	,	2223279582	,	2427912951	,	3131105060	,	1039346293	,	1281978426	,	2691295235	,	246149792	,	1506147105	,	1394281430	,	1903208271	,	4027757916	,
						2239337485	,	3336150194	,	1096789211	,	1333232472	,	1655898425	,	2692259534	,	2613552295	,	2654337172	,	720473765	,	1216007722	,	285309619	,	3466522896	,	66766929	,	4184745670	,	2604292863	,	3883174092	,	1350990397	,	3683116194	,	3720327563	,	1185291208	,	3375018089	,	360743870	,	2861247063	,	4014753284	,	1770501845	,	1320140826	,	2047783267	,	2128929664	,	2108955009	,	1583912374	,	3242226351	,	2781810748	,	1541973101	,	613761170	,	1374083643	,	1057433656	,	2523685785	,	3348315310	,	824480775	,	1663223668	,	2982191877	,	3545187850	,	2420411411	,	311216624	,	2869751473	,	4120991910	,	3552964191	,	1392593836	,	3670741661	,	1407758466	,	3567789803	,	3695814824	,	4289927881	,	3051866526	,	3354845623	,	2956492004	,	2112312117	,	31481850	,	2023099075	,	971351136	,	509626337	,	3320803222	,	3209547279	,	3492428572	,	3667444941	,	3400086642	,	1695979419	,	3076300056	,	2155468281	,	3941935758	,	3685028711	,	4266419796	,	981911397	,	2905214442	,	2016816499	,	3531502288	,	1212753169	,	1500109446	,	479924671	,	665378444	,	1929165565	,	2302528610	,	2055547979	,	3463382408	,	175871273	,	1819434878	,	1561471255	,	1448969156	,	1986658197	,	1060327386	,	2761421859	,	1462121792	,	2812446273	,	2909247862	,	3769678191	,	4246484476	,	4125226285	,	525170770	,	3028739323	,	4109361656	,
						900946009	,	727083118	,	1902191303	,	313185588	,	312212421	,	2839750090	,	2473483987	,	1340861360	,	4186401649	,	578792550	,	215074079	,	4251140460	,	527659869	,	2613000258	,	2330902955	,	1133392488	,	1885085577	,	4091037022	,	569704567	,	1320376996	,	1919400949	,	1407225786	,	179072387	,	3256784416	,	1767036065	,	1820922710	,	1585525967	,	1318912220	,	1176253837	,	2092567602	,	4258251355	,	2285434584	,	787540665	,	1567553102	,	208716327	,	1463161876	,	2874687525	,	248679850	,	2961514547	,	2689414288	,	3231695313	,	2191183430	,	4286711935	,		2651212	,	2324118461	,	2678387746	,	1165813515	,	3055497032	,	472693225	,	3134290750	,	314009559	,	439484804	,	3040381013	,	18882458	,	3144382179	,	977716992	,	2538156801	,	2399919414	,	903299119	,	2057608124	,	127895021	,	824635410	,	2190028731	,	1437588408	,	1225428249	,	167171118	,	183234951	,	2531664628	,	2584974469	,	2567980426	,	2719117715	,	2904182128	,	2204772401	,	3748872230	,	331602911	,	4025513772	,	42996765	,	2636578818	,	1841798251	,	4103732264	,	1556440137	,	3826647326	,	1869700919	,	1305573476	,	2788451509	,	2083127162	,	3412922435	,	1394001888	,	1230872929	,	3567777558	,	667605903	,	3408594588	,	449046093	,	2127307762	,	139144475	,	2513211544	,	3302506361	,	1839596046	,	250261735	,	2964521428	,
						2552625381	,	1999916394	,	1051611891	,	868955728	,	197041809	,	3535864326	,	749682495	,	548620812	,	2045115517	,	2424134626	,	1265033675	,	561420552	,	3841859241	,	1180555006	,	3157976727	,	2458500932	,	3501412629	,	1849044826	,	1397307811	,	1946589376	,	2070421441	,	823484662	,	3111388911	,	505954684	,	65099437	,	2615257042	,	3635264123	,	3574011256	,	1194459609	,	2033483758	,	4270129223	,	2543104180	,	2196204869	,	1282843978	,	1626391635	,	3319263024	,	125117681	,	708580326	,	4049351327	,	2053696748	,	2262889693	,	1776289730	,	2851256107	,	3006072296	,	3417237769	,	1818295518	,	3240885751	,	2773669412	,	3826077045	,	4101812026	,	1872229123	,	3633199520	,	222342689	,	3423345366	,	871023183	,	3851701340	,	3947878157	,	2996796338	,	3242776539	,	4090980952	,	3639596089	,	3512356302	,	64151463	,	1384329108	,	1538257317	,	806309162	,	3882993075	,	3367532560	,	140884817	,	3885790662	,	3437409791	,	2030657484	,	1675164989	,	226952098	,	3640859787	,	1949647560	,	2343551849	,	2497147582	,	2321327447	,	1462025476	,	3013237205	,	2687860506	,	1089551459	,	2418387584	,	3267316865	,	21243062	,	2756119983	,	661071676	,	2640799597	,	3778912146	,	330597691	,	649432888	,	3874076313	,	3469700014	,	2364296967	,	4235624052	,	1205306885	,	2906014986	,	3033093907	,	1977929968	,
						2221433265	,	1083844518	,	3998927199	,	747414188	,	4012250525	,	1403670402	,	2888831467	,	2198294440	,	64531913	,	2994288798	,	1743051959	,	2365027300	,	917665333	,	1989713658	,	3958183363	,	2118445920	,	1136392929	,	1618312854	,	3684755727	,	2107167260	,	2323646413	,	972297074	,	2777203355	,	4128867352	,	1106749689	,	2118900110	,	1273581159	,	3295059284	,	2427857509	,	3273886954	,	2945415283	,	3671390672	,	3579123729	,	2666342790	,	1222405311	,	954905996	,	2871016957	,	142732130	,	2064750411	,	1377512584	,	1996597289	,	1811828350	,	3990660119	,	1069742788	,	2293080725	,	4041084634	,	2569240355	,	1516502080	,	470726977	,	2908235894	,	1863341167	,	371281148	,	3337730093	,	3271219026	,	3495792635	,	1048267000	,	519154521	,	2693240686	,	920772039	,	3981151284	,	2745425605	,	3842974922	,	3260819923	,	3640718000	,	956554865	,	2689432422	,	2474614815	,	3592132716	,	3189732957	,	3964000066	,	557821099	,	2817055080	,	2348987017	,	471774302	,	4099668855	,	2088718756	,	3907247861	,	4231909050	,	1965848707	,	2952453408	,	3146745761	,	3752075862	,	3081588687	,	3002636252	,	185890957	,	1988750130	,	1909124443	,	810737112	,	380616121	,	2855970126	,	2280520999	,	3458026260	,	301507365	,	4197518506	,	3687279411	,	635485072	,	3511465169	,	376642886	,	1230791551	,	3491187532	,
						4068196029	,	3006141218	,	4266807819	,	2666026568	,	1303629033	,	3516033598	,	2541413079	,	1680111748	,	3131910997	,	4193246874	,	2963276259	,	3733032448	,	1981179393	,	588344374	,	3532643119	,	2853614268	,	3007334637	,	1121537810	,	3949517499	,	1343767224	,	638181401	,	3290235694	,	3173362823	,	3520322036	,	2433513349	,	1572947082	,	3999874195	,	1257002096	,	2751961905	,	118886182	,	2844440287	,	2262158892	,	3062699805	,	91397890	,	4125198187	,	2777785128	,	720172873	,	1326542878	,	928078391	,	732589924	,	2237761461	,	3207347834	,	2148932419	,	426774240	,	2205897825	,	3612870166	,	2697983631	,	3849559452	,	3217893709	,	169935602	,	584013851	,	1984133016	,	2916618873	,	3404116238	,	2560682983	,	2003253460	,	4197932005	,	3740781674	,	4040793587	,	2778447184	,	2601292177	,	2884522246	,	3072498239	,	3998163212	,	481001341	,	2135653090	,	1871006923	,	2120007688	,	4135989673	,	190039550	,	2012701079	,	470365764	,	4099470357	,	2502618714	,	472302755	,	1748918208	,	4288041665	,	2419060726	,	3347423727	,	3808909436	,	3574798765	,	2727937746	,	2174117243	,	3477896312	,	1928484057	,	1330622190	,	544717639	,	1372546996	,	1255231557	,	3238831178	,	3719335763	,	1734800944	,	2217973745	,	1924391654	,	960236959	,	2390442988	,	3677288413	,	2968561346	,	1456841259	,	1069657320	,
						3881270281	,	823225310	,	1099233527	,	2453196068	,	3605753973	,	958656058	,	3244948995	,	2791604384	,	3930022177	,	357640662	,	2949176655	,	3033129820	,	996809229	,	3598277298	,	4116054747	,	3685437784	,	2653988665	,	2517630158	,	2663520935	,	134506132	,	2754761893	,	3140996138	,	3011907763	,	2512781072	,	290762321	};

		for (mti=0;mti<N;mti++) Seed[mti]=mt_init[mti];
		mti=N+1;	
}

double MT::Genrand(/*unsigned long Seed*/){
	unsigned long y;
	static unsigned long mag01[2]={0x0,MATRIX_A};
	// If called with a new seed the algorithm starts over
	//if(Seed!=actual_seed){
	//	actual_seed=Seed;
	//	mti=N+1;
	//}

	// Modification of the array of size N=624 (only each time 624 numbers have been outputted)
	if(mti>=N){
		int kk;
		//if(mti==N+1){
		//	Init_MT_rand(); //Initialisation only the first time
		//}
		for(kk=0;kk<N-M;kk++){
			y=(Seed[kk]&UPPER_MASK)|(Seed[kk+1]&LOWER_MASK);
			Seed[kk]=Seed[kk+M]^(y>>1)^mag01[y & 0x1];
		}
		for(;kk<N-1;kk++){
			y=(Seed[kk]&UPPER_MASK)|(Seed[kk+1]&LOWER_MASK);
			Seed[kk]=Seed[kk+(M-N)]^(y>>1)^mag01[y & 0x1];
		}
		y=(Seed[N-1]&UPPER_MASK)|(Seed[0]&LOWER_MASK);
		Seed[N-1]=Seed[M-1]^(y>>1)^mag01[y & 0x1];
		mti=0;
	}

	// Returns an element of the array modified for better randomness
	y=Seed[mti++];
	y^=TEMPERING_SHIFT_U(y);
	y^=TEMPERING_SHIFT_S(y)& TEMPERING_MASK_B;
	y^=TEMPERING_SHIFT_T(y)& TEMPERING_MASK_C;
	y^=TEMPERING_SHIFT_L(y);
	
	// Returns a real on ]0;1[
	return (((double)y) + 0.5)*(1.0/4294967296.0);
}


